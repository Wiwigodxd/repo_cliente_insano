<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compras | Panel Tienda</title>
    <link rel="stylesheet" href="css/styless.css">
</head>
<body>

    <header class="header">
        <h1>Registro de Compras</h1>
        <button class="logout-btn" onclick="logout()">Cerrar sesión</button>
    </header>

    <div class="container">
        <div id="comprasList" class="card-container"></div>
        <p id="errorMessage" class="error"></p>
    </div>

    <script>
        // NUEVA URL PARA TU TIENDA ONLINE
        const apiUrl = "http://127.0.0.1:8000/api/productos/";

        // Verifica sesión
        if (!localStorage.getItem("access_token")) {
            window.location.href = "index.html";
        } else {
            fetchCompras();
        }

        // Obtener datos de compras
        async function fetchCompras() {
            try {
                const response = await fetch(apiUrl, {
                    method: "GET",
                    headers: {
                        "Authorization": "Bearer " + localStorage.getItem("access_token")
                    }
                });

                if (!response.ok) {
                    throw new Error("Error al obtener las compras");
                }

                const data = await response.json();
                const compras = data.results || [];

                const container = document.getElementById("comprasList");
                container.innerHTML = "";

                if (compras.length === 0) {
                    showError("No hay compras registradas todavía.");
                    return;
                }

                // Mostrar tarjetas de compras
                compras.forEach(compra => {
                    const card = document.createElement("div");
                    card.classList.add("contact-card");

                    card.innerHTML = `
                        <h3>Cliente: ${compra.rut_cliente}</h3>

                        <p><strong>Producto:</strong> ${compra.producto}</p>
                        <p><strong>Descripción:</strong> ${compra.descripcion}</p>
                        <p><strong>Precio:</strong> $${compra.precio}</p>
                        <p><strong>Cantidad:</strong> ${compra.cantidad}</p>
                    `;

                    container.appendChild(card);
                });

            } catch (error) {
                console.error(error);
                showError("Ocurrió un error al cargar las compras.");
            }
        }

        // Cerrar sesión
        function logout() {
            localStorage.removeItem("access_token");
            window.location.href = "index.html";
        }

        function showError(msg) {
            const errorMessage = document.getElementById("errorMessage");
            errorMessage.textContent = msg;
        }
    </script>

</body>
</html>
